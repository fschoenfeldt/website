<form
  @submit.prevent="$dispatch('submitvacationform')"
  class="mx-4 max-w-xl space-y-6 rounded-xl bg-white shadow-2xl md:mx-0 dark:bg-gray-800"
  data-testid="vacationForm"
>
  <div class="flex items-center">
    <div class="flex w-full items-center gap-4 rounded-t-xl bg-blue-600 p-4">
      <div
        aria-hidden="true"
        class="flex h-8 w-8 items-center justify-center rounded-full border border-blue-200 bg-blue-100 p-2 text-xl"
      >
        üèùÔ∏è
      </div>
      <h1 class="break-normal font-sans text-xl font-bold text-white">
        Eigenen Urlaubscountdown setzen
      </h1>
    </div>
  </div>
  <p class="px-4">
    Mithilfe dieses Formulars kannst du deinen eigenen Urlaubscountdown setzen.
    Anschlie√üend erh√§lst du einen Link, den du teilen kannst:
  </p>
  <div
    class="space-y-4 rounded-b-xl border-y border-b-4 bg-gray-100 dark:border-gray-600 dark:bg-gray-700"
  >
    <ol class="ml-4 list-decimal space-y-2 p-4 pb-0">
      <li>
        <strong class="block">Urlaubstag ausw√§hlen</strong>
        <label for="date">Urlaubsdatum (erforderlich)</label>
        <input
          class="block bg-gray-200 px-2 text-xl dark:bg-gray-800"
          type="date"
          name="date"
          id="date"
          x-ref="inputdate"
          data-testid="vacationDate"
          required
        />
      </li>
      <li>
        <strong class="block">Urlaubsort ausw√§hlen</strong>
        <label for="vacationlocation">Urlaubsort (optional)</label>
        <input
          class="block bg-gray-200 px-2 text-xl dark:bg-gray-800"
          type="text"
          name="vacationlocation"
          id="vacationlocation"
          x-ref="inputvacationlocation"
          data-testid="vacationLocation"
        />
      </li>
      <li>
        <strong class="block"
          >Hintergrundbild ausw√§hlen (optional, experimentell)</strong
        >
        <form
          x-data
          @submit.prevent="$dispatch('submitvacationimagesearch')"
          class="rounded border bg-gray-50 p-4 dark:bg-gray-900"
        >
          <div>
            <label class="block" for="vacationimagesearch"
              >Suche auf Fotoh√§cker nach einem Hintergrundbild</label
            >
            <div class="flex flex-wrap gap-2">
              <input
                class="block bg-gray-200 px-2 dark:bg-gray-800"
                type="text"
                name="vacationimagesearch"
                id="vacationimagesearch"
                data-testid="vacationImageSearch"
                placeholder="Schottland"
                :value="$store.vacation.vacationImageSearch"
                x-model="$store.vacation.vacationImageSearch"
              />
              <button
                class="btn btn--lg"
                type="submit"
                data-testid="vacationImageSearchSubmit"
              >
                Suchen
              </button>
            </div>
            <template x-if="$store.vacation.vacationImagesResult">
              <div>
                <p
                  x-text="`${$store.vacation.vacationImagesResult.length} Ergebnisse`"
                ></p>
                <p
                  class="mt-4"
                  x-show="$store.vacation.vacationImagesResult.length > 0"
                >
                  W√§hle ein Bild aus:
                </p>
                <ul
                  class="grid grid-cols-1 gap-2 md:grid-cols-2"
                  data-testid="vacationImageResultList"
                >
                  <template
                    x-for="image in $store.vacation.vacationImagesResult"
                  >
                    <li class="flex flex-col">
                      <label :for="`inputvacationimage-${image.id}`">
                        <p
                          class="sr-only"
                          x-text="`Foto ${image.title} auf Fotoh√§cker`"
                        ></p>
                        <img
                          :src="image.urls.thumb3x"
                          :alt="image.title"
                          class="cursor-pointer rounded"
                          :class="{ 'ring-4': $store.vacation.vacationImage == image.id}"
                        />
                      </label>
                      <input
                        type="radio"
                        :id="`inputvacationimage-${image.id}`"
                        :value="image.id"
                        name="inputvacationimage"
                        x-model="$store.vacation.vacationImage"
                        class="sr-only"
                      />
                    </li>
                  </template>
                </ul>
              </div>
            </template>
          </div>
        </form>
      </li>
    </ol>
    <template x-if="$store.vacation.generatedLink">
      <div data-testid="result" class="px-4">
        Dein Link:
        <a
          :href="$store.vacation.generatedLink"
          target="_blank"
          rel="noopener noreferrer"
          x-text="$store.vacation.generatedLink"
          class="break-words"
        ></a>
      </div>
    </template>
    <div class="flex items-center justify-between gap-x-2 border-t p-4">
      <button data-testid="submitButton" class="btn btn--lg btn--blue">
        Speichern
      </button>
      {# only show this close button if it's not a fresh page visit.
                TODO refactor this to the store. #}
      <button
        type="button"
        label="Eingabe abbrechen"
        class="btn dark:text-gray-900"
        @click="$store.vacation.editMode = false"
        x-show="!!$store.vacation.vacationLocation || !!$store.vacation.date"
      >
        Abbrechen
      </button>
    </div>
  </div>
</form>
